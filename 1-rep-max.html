<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PowerCalc: Safety Edition v18</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@400;600&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #f1f5f9; }
        h1, h2, h3, .brand-font { font-family: 'Teko', sans-serif; }
        
        /* Remove arrows from number inputs */
        input[type="number"]::-webkit-inner-spin-button, 
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        
        select { -webkit-appearance: none; appearance: none; }
        
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .pulse-active { animation: pulse-red 2s infinite; }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(245, 158, 11, 0); }
            100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0); }
        }

        .vertical-text {
            writing-mode: vertical-rl;
            text-orientation: mixed;
            transform: rotate(180deg);
        }
    </style>
</head>
<body class="min-h-screen pb-32 selection:bg-amber-500 selection:text-slate-900">

    <nav class="border-b border-slate-800 bg-slate-900/95 backdrop-blur-md sticky top-0 z-50">
        <div class="max-w-3xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <span class="text-2xl">üõ°Ô∏è</span>
                <div>
                    <h1 class="text-xl font-semibold tracking-wide text-white brand-font uppercase">Safe<span class="text-amber-500">Max</span></h1>
                </div>
            </div>
             <div class="bg-slate-800 p-1 rounded-lg flex text-[10px] font-bold border border-slate-700">
                <button onclick="setUnit('kg')" id="btn-kg" class="px-3 py-1 rounded-md transition-all bg-amber-500 text-slate-900 shadow">KG</button>
                <button onclick="setUnit('lbs')" id="btn-lbs" class="px-3 py-1 rounded-md transition-all text-slate-400 hover:text-white">LBS</button>
            </div>
        </div>
    </nav>

    <div class="max-w-3xl mx-auto px-4 mt-4 space-y-3">

        <div class="bg-slate-900 border border-slate-800 rounded-2xl p-4 shadow-lg">
            <h2 class="text-white text-lg uppercase tracking-wide brand-font mb-2 flex items-center gap-2">
                <span class="text-amber-500">1.</span> Calculate Stats
            </h2>
            
            <div class="grid grid-cols-2 gap-3 mb-1">
                <div>
                    <label class="block text-slate-400 text-[9px] font-bold uppercase tracking-widest mb-1">Weight</label>
                    <div class="relative">
                        <input type="number" id="input-weight" placeholder="100" oninput="calculate()" class="w-full bg-slate-950 text-white p-2 rounded-xl border border-slate-800 focus:border-amber-500 outline-none font-bold text-xl text-center placeholder-slate-800 transition-all focus:ring-1 focus:ring-amber-500/50">
                        <span id="label-unit" class="absolute right-3 top-3.5 text-slate-600 text-[9px] font-bold">KG</span>
                    </div>
                </div>

                <div>
                    <label class="block text-slate-400 text-[9px] font-bold uppercase tracking-widest mb-1">Reps</label>
                    <div class="relative">
                        <input type="number" id="input-reps" placeholder="5" oninput="calculate()" class="w-full bg-slate-950 text-white p-2 rounded-xl border border-slate-800 focus:border-amber-500 outline-none font-bold text-xl text-center placeholder-slate-800 transition-all focus:ring-1 focus:ring-amber-500/50">
                        <span class="absolute right-3 top-3.5 text-slate-600 text-[9px] font-bold">REPS</span>
                    </div>
                </div>
            </div>
            
             <div id="rep-warning" class="hidden mt-2 text-center">
                <p class="text-[10px] text-orange-400 font-bold bg-orange-500/10 border border-orange-500/20 py-1 rounded-lg inline-block px-3">
                    ‚ö†Ô∏è Accuracy drops above 12 reps.
                </p>
            </div>
        </div>

        <div id="result-panel" class="hidden fade-in space-y-3">
            
            <div class="bg-gradient-to-br from-slate-800 to-slate-900 border border-slate-700 rounded-2xl p-4 text-center relative overflow-hidden shadow-xl">
                <div class="absolute top-0 right-0 w-64 h-64 bg-amber-500/5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"></div>
                <p class="text-slate-400 text-[10px] font-bold uppercase tracking-widest mb-0">Estimated 1 Rep Max</p>
                <div class="flex justify-center items-baseline gap-1">
                    <span id="val-1rm" class="text-6xl font-black text-white brand-font tracking-tight drop-shadow-lg">--</span>
                    <span id="val-unit" class="text-lg text-slate-500 font-bold">KG</span>
                </div>
            </div>

            <div class="bg-slate-900 border border-slate-800 rounded-2xl overflow-hidden shadow-xl shadow-black/20">
                <div class="p-4 sm:p-5 bg-slate-950 border-b border-slate-800">
                    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                        <h3 class="text-white font-bold brand-font text-xl sm:text-2xl flex items-center gap-2 whitespace-nowrap">
                            <span class="text-amber-500">2.</span> Ramp-Up
                        </h3>
                        
                        <div class="flex items-end gap-3 w-full sm:w-auto">
                            <div class="w-full sm:w-auto">
                                <label class="block text-slate-500 text-[10px] font-bold uppercase tracking-widest mb-1.5 text-center">Target</label>
                                <div class="relative">
                                    <select id="warmup-target" onchange="calculate()" class="w-full sm:w-32 bg-slate-900 text-white font-bold text-sm uppercase tracking-wider py-3 pl-3 pr-8 rounded-lg border border-slate-700 focus:border-amber-500 outline-none cursor-pointer appearance-none hover:bg-slate-800 transition">
                                        <option value="1">1RM</option>
                                        <option value="3">3RM</option>
                                        <option value="5" selected>5RM</option>
                                        <option value="8">8RM</option>
                                        <option value="10">10RM</option>
                                    </select>
                                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-slate-400">
                                        <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                                    </div>
                                </div>
                            </div>

                            <div class="w-full sm:w-24">
                                <label class="block text-slate-500 text-[10px] font-bold uppercase tracking-widest mb-1.5 text-center">Bar</label>
                                <input type="number" id="bar-weight" value="20" oninput="calculate()" class="w-full bg-slate-900 text-center text-white text-sm font-bold py-3 px-2 rounded-lg border border-slate-700 outline-none focus:border-amber-500 transition-colors placeholder-slate-600">
                            </div>

                            <div class="w-full sm:w-24">
                                <label class="block text-slate-500 text-[10px] font-bold uppercase tracking-widest mb-1.5 text-center">Inc</label>
                                <div class="relative">
                                    <select id="rounding-factor" onchange="calculate()" class="w-full bg-slate-900 text-center text-white text-sm font-bold py-3 pr-6 rounded-lg border border-slate-700 outline-none focus:border-amber-500 transition-colors appearance-none">
                                        <option value="0.5">0.5</option>
                                        <option value="1">1</option>
                                        <option value="1.25" selected>1.25</option>
                                        <option value="2.5">2.5</option>
                                        <option value="5">5</option>
                                    </select>
                                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-400">
                                        <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex flex-col bg-slate-900" id="warmup-container">
                </div>
            </div>
            
            <div class="bg-slate-900 border border-slate-800 rounded-2xl overflow-hidden shadow-lg">
                <div class="p-2 bg-slate-950 border-b border-slate-800">
                     <h3 class="text-white text-xs font-bold brand-font tracking-wide">Percentage Reference</h3>
                </div>

                <div class="p-0">
                    <table class="w-full text-sm text-left text-slate-400">
                        <thead class="text-[10px] text-slate-500 uppercase bg-slate-900/50">
                            <tr>
                                <th class="px-2 py-2 w-8 text-center">Zone</th>
                                <th class="px-3 py-2">%</th>
                                <th class="px-3 py-2">Load</th>
                                <th class="px-3 py-2 text-right">Reps</th>
                            </tr>
                        </thead>
                        <tbody id="percentage-table-body" class="divide-y divide-slate-800/50"></tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>

    <div id="timer-bar" class="fixed bottom-0 left-0 w-full bg-slate-900 border-t border-amber-500/30 p-3 transform translate-y-full transition-transform duration-300 z-50 shadow-[0_-10px_40px_rgba(0,0,0,0.5)]">
        <div class="max-w-3xl mx-auto flex items-center justify-between">
            <div class="flex flex-col">
                <span class="text-[8px] text-amber-500 uppercase font-bold tracking-widest">Rest Timer</span>
                <span id="timer-display" class="text-2xl font-black text-white brand-font font-mono">00:00</span>
            </div>
            <div class="flex gap-2">
                <button onclick="addTime(-30)" class="bg-slate-800 hover:bg-slate-700 text-white text-[10px] px-3 py-2 rounded border border-slate-700 font-bold transition-colors">-30s</button>
                <button onclick="addTime(30)" class="bg-slate-800 hover:bg-slate-700 text-white text-[10px] px-3 py-2 rounded border border-slate-700 font-bold transition-colors">+30s</button>
                <button onclick="stopTimer()" class="bg-slate-800 hover:bg-red-900/30 hover:border-red-500/50 hover:text-red-400 text-slate-400 text-[10px] px-4 py-2 rounded border border-slate-700 font-bold uppercase transition-all">Stop</button>
            </div>
        </div>
        <div class="absolute top-0 left-0 h-1 bg-amber-500 transition-all duration-1000 ease-linear" id="timer-progress" style="width: 100%"></div>
    </div>

    <script>
        let unit = 'kg';
        let timerInterval;
        let totalTime = 0;
        let remainingTime = 0;
        let audioCtx;

        window.onload = function() {
            loadData();
        };

        function saveData() {
            const data = {
                weight: document.getElementById('input-weight').value,
                reps: document.getElementById('input-reps').value,
                unit: unit,
                barWeight: document.getElementById('bar-weight').value,
                rounding: document.getElementById('rounding-factor').value
            };
            localStorage.setItem('powerCalcData', JSON.stringify(data));
        }

        function loadData() {
            const saved = localStorage.getItem('powerCalcData');
            if (saved) {
                const data = JSON.parse(saved);
                document.getElementById('input-weight').value = data.weight || '';
                document.getElementById('input-reps').value = data.reps || '';
                document.getElementById('bar-weight').value = data.barWeight || '20';
                document.getElementById('rounding-factor').value = data.rounding || '1.25';
                if(data.unit) setUnit(data.unit);
            }
            if (document.getElementById('input-weight').value) calculate();
        }

        function setUnit(u) {
            unit = u;
            document.getElementById('label-unit').innerText = u.toUpperCase();
            document.getElementById('val-unit').innerText = u.toUpperCase();
            
            if (u === 'kg') {
                document.getElementById('btn-kg').className = "px-3 py-1 rounded-md transition-all bg-amber-500 text-slate-900 shadow font-bold";
                document.getElementById('btn-lbs').className = "px-3 py-1 rounded-md transition-all text-slate-400 hover:text-white font-medium";
            } else {
                document.getElementById('btn-lbs').className = "px-3 py-1 rounded-md transition-all bg-amber-500 text-slate-900 shadow font-bold";
                document.getElementById('btn-kg').className = "px-3 py-1 rounded-md transition-all text-slate-400 hover:text-white font-medium";
            }
            calculate();
        }

        function calculate() {
            const weight = parseFloat(document.getElementById('input-weight').value);
            const reps = parseFloat(document.getElementById('input-reps').value);
            const targetReps = parseInt(document.getElementById('warmup-target').value);
            const rounding = parseFloat(document.getElementById('rounding-factor').value);
            const resultPanel = document.getElementById('result-panel');
            const warningPanel = document.getElementById('rep-warning');

            saveData();

            if (!weight || !reps) {
                resultPanel.classList.add('hidden');
                return;
            }

            if (reps > 12) warningPanel.classList.remove('hidden');
            else warningPanel.classList.add('hidden');

            let oneRM = weight * (1 + reps / 30);
            oneRM = Math.round(oneRM * 2) / 2;

            resultPanel.classList.remove('hidden');
            document.getElementById('val-1rm').innerText = oneRM;

            const standardRounding = unit === 'kg' ? 0.5 : 1.0;
            renderTable(oneRM, standardRounding);
            renderWarmup(oneRM, targetReps, rounding);
        }

        function roundTo(val, step) {
            return Math.round(val / step) * step;
        }

        function renderWarmup(oneRM, targetReps, rounding) {
            const container = document.getElementById('warmup-container');
            container.innerHTML = ''; // Clear previous results

            // Render Header Row - Larger text and padding
            const header = document.createElement('div');
            header.className = "flex items-center px-3 sm:px-5 py-4 bg-slate-950/80 border-b border-slate-800 text-[10px] sm:text-xs font-bold text-slate-500 uppercase tracking-widest";
            header.innerHTML = `
                <div class="w-8 sm:w-10 text-center">Set</div>
                <div class="flex-1 pl-2 sm:pl-3 text-left">Strategy</div>
                <div class="w-14 sm:w-24 text-center">Side</div>
                <div class="w-12 sm:w-20 text-center">Load</div>
                <div class="w-10 sm:w-16 text-center">Reps</div>
                <div class="w-14 sm:w-20 text-center">Timer</div>
            `;
            container.appendChild(header);

            let targetLoad = oneRM / (1 + targetReps / 30);
            const barWeight = parseFloat(document.getElementById('bar-weight').value) || 0;

            const steps = [
                { title: "Activation", pct: 0.20, reps: "15", restSec: 0, notes: "Light" },
                { title: "Patterning", pct: 0.50, reps: "5", restSec: 60, notes: "Fast" },
                { title: "Acclimation", pct: 0.70, reps: "3", restSec: 120, notes: "Build" },
                { title: "Primer", pct: 0.90, reps: targetReps > 5 ? "2" : "1", restSec: 180, notes: "Heavy" },
                { title: `TEST ${targetReps}RM`, pct: 1.00, reps: targetReps, restSec: 240, notes: "TARGET" }
            ];

            // Reusable stacked text for the empty bar state - bigger text
            const emptyBarHtml = `<span class="text-[9px] sm:text-[11px] uppercase text-slate-400 tracking-tighter leading-[1.1] block">Empty<br>Bar</span>`;

            steps.forEach((step, index) => {
                let rawLoad = targetLoad * step.pct;
                let finalLoad = 0;
                let sideBoxText = "‚Äî";

                if (barWeight === 0) {
                    finalLoad = roundTo(rawLoad, rounding);
                } else {
                    if (rawLoad <= barWeight) {
                        finalLoad = barWeight;
                        sideBoxText = emptyBarHtml;
                    } else {
                        let idealSide = (rawLoad - barWeight) / 2;
                        let roundedSide = roundTo(idealSide, rounding);
                        finalLoad = barWeight + (roundedSide * 2);
                        if (roundedSide > 0) {
                            sideBoxText = roundedSide;
                        } else {
                            sideBoxText = emptyBarHtml;
                        }
                    }
                }
                
                let rowBg = "hover:bg-slate-800/30";
                let badgeBg = "bg-slate-800 text-slate-400 border-slate-700";
                let textClass = "text-slate-300";
                let numColor = "text-white";
                let btnClass = "bg-slate-800 text-slate-400 hover:bg-slate-700 hover:text-white border-slate-700";
                let borderBottom = "border-slate-800/50";
                
                if (step.pct === 1.0) {
                    rowBg = "bg-amber-500/5 hover:bg-amber-500/10";
                    badgeBg = "bg-amber-500 text-slate-900 font-bold border-amber-400";
                    textClass = "text-amber-500 font-bold";
                    numColor = "text-amber-500";
                    btnClass = "bg-amber-500/20 text-amber-500 border-amber-500/30 hover:bg-amber-500/30";
                }

                let restLabel = step.restSec === 0 ? "‚Äî" : (step.restSec >= 60 ? `${step.restSec/60}M` : `${step.restSec}S`);
                
                let timerButton = step.restSec > 0 ? 
                    `<button onclick="startTimer(${step.restSec})" class="w-full h-8 sm:h-10 rounded-lg flex items-center justify-center gap-1 transition-all border text-[10px] sm:text-xs font-bold uppercase tracking-widest ${btnClass}">
                        <span>${restLabel}</span>
                    </button>` : 
                    `<div class="w-full h-8 sm:h-10 rounded-lg flex items-center justify-center border border-transparent opacity-20 text-slate-500 text-xs">
                        <span>‚Äî</span>
                    </div>`;

                const row = document.createElement('div');
                // Massive padding bump here
                row.className = `flex items-center px-3 sm:px-5 py-4 sm:py-5 border-b transition-colors ${borderBottom} ${rowBg}`;
                
                row.innerHTML = `
                    <div class="w-8 sm:w-10 text-center flex justify-center">
                        <div class="w-6 h-6 sm:w-8 sm:h-8 flex items-center justify-center rounded-full text-[10px] sm:text-xs border ${badgeBg}">${index + 1}</div>
                    </div>
                    
                    <div class="flex-1 pl-2 sm:pl-3 flex flex-col justify-center">
                        <span class="text-[14px] sm:text-[16px] leading-tight whitespace-nowrap tracking-tight ${textClass}">${step.title}</span>
                    </div>
                    
                    <div class="w-14 sm:w-24 flex justify-center items-center">
                        <div class="bg-slate-600/30 text-slate-200 font-bold text-sm sm:text-base min-h-[36px] sm:min-h-[44px] rounded-lg w-12 sm:w-20 flex items-center justify-center text-center border border-slate-600/50 shadow-sm overflow-hidden">
                            ${sideBoxText}
                        </div>
                    </div>
                    
                    <div class="w-12 sm:w-20 text-center">
                        <span class="text-xl sm:text-3xl font-black ${numColor} brand-font tracking-tight leading-none drop-shadow-sm">${finalLoad}</span>
                    </div>
                    
                    <div class="w-10 sm:w-16 text-center">
                        <span class="text-lg sm:text-2xl font-black text-white brand-font tracking-tight leading-none drop-shadow-sm">${step.reps}</span>
                    </div>
                    
                    <div class="w-14 sm:w-20 text-center pl-2 sm:pl-3">
                        ${timerButton}
                    </div>
                `;
                container.appendChild(row);
            });
        }

        function renderTable(oneRM, rounding) {
            const tbody = document.getElementById('percentage-table-body');
            tbody.innerHTML = '';
            
            const data = [
                { pct: 100, reps: '1', zone: 'POWER', span: 4, color: 'text-amber-500', border: 'border-l-2 border-amber-500' }, 
                { pct: 95, reps: '2' }, 
                { pct: 90, reps: '3-4' },
                { pct: 85, reps: '5-6' }, 
                { pct: 80, reps: '7-8', zone: 'HYPERTROPHY', span: 3, color: 'text-blue-400', border: 'border-l-2 border-blue-500' }, 
                { pct: 75, reps: '9-10' },
                { pct: 70, reps: '11-12' }, 
                { pct: 65, reps: '13-15', zone: 'ENDURANCE', span: 2, color: 'text-emerald-400', border: 'border-l-2 border-emerald-500' }, 
                { pct: 60, reps: '16-20' }
            ];

            data.forEach((row) => {
                let load = roundTo(oneRM * (row.pct / 100), rounding);

                let colorClass = "text-slate-400";
                if(row.pct === 100) colorClass = "text-amber-500 font-bold";
                
                const tr = document.createElement('tr');
                
                let zoneHtml = '';
                if (row.zone) {
                    zoneHtml = `<td rowspan="${row.span}" class="p-0 text-center align-middle bg-slate-900/30 ${row.border}">
                        <div class="vertical-text text-[8px] font-bold tracking-widest uppercase ${row.color} opacity-80">${row.zone}</div>
                    </td>`;
                }

                tr.innerHTML = `
                    ${zoneHtml}
                    <td class="px-3 py-1 font-bold ${colorClass} text-[10px]">${row.pct}%</td>
                    <td class="px-3 py-1 font-mono text-white text-xs">${load}</td>
                    <td class="px-3 py-1 text-right text-[9px] uppercase tracking-wide text-slate-500 font-bold">${row.reps}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        /* --- Audio & Timer Logic --- */
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        function beep(duration, frequency, volume, type) {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            gainNode.gain.value = volume;
            osc.frequency.value = frequency;
            osc.type = type;
            
            osc.start(audioCtx.currentTime);
            osc.stop(audioCtx.currentTime + (duration / 1000));
        }

        function playAlarm() {
            initAudio(); 
            beep(150, 1000, 0.3, 'square');
            setTimeout(() => beep(150, 1000, 0.3, 'square'), 300);
            setTimeout(() => beep(400, 800, 0.3, 'square'), 600);

            document.getElementById('timer-display').classList.add('text-red-500', 'pulse-active');
            setTimeout(() => {
                 document.getElementById('timer-display').classList.remove('text-red-500', 'pulse-active');
                 stopTimer();
            }, 3000);
        }

        function startTimer(seconds) {
            initAudio();
            clearInterval(timerInterval);
            totalTime = seconds;
            remainingTime = seconds;
            
            const timerBar = document.getElementById('timer-bar');
            timerBar.classList.remove('translate-y-full'); 
            
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                remainingTime--;
                updateTimerDisplay();
                if (remainingTime <= 0) {
                    clearInterval(timerInterval);
                    playAlarm();
                }
            }, 1000);
        }

        function addTime(sec) {
            remainingTime += sec;
            if (remainingTime < 0) remainingTime = 0;
            if(remainingTime > totalTime) totalTime = remainingTime;
            updateTimerDisplay();
        }

        function stopTimer() {
            clearInterval(timerInterval);
            document.getElementById('timer-bar').classList.add('translate-y-full');
        }

        function updateTimerDisplay() {
            const mins = Math.floor(remainingTime / 60);
            const secs = remainingTime % 60;
            document.getElementById('timer-display').innerText = 
                `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            
            let pct = 0;
            if(totalTime > 0) pct = (remainingTime / totalTime) * 100;
            document.getElementById('timer-progress').style.width = `${pct}%`;
        }
    </script>
</body>
</html>