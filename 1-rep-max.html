<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PowerCalc: Safety Edition v14</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@400;600&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #f1f5f9; }
        h1, h2, h3, .brand-font { font-family: 'Teko', sans-serif; }
        
        input[type="number"]::-webkit-inner-spin-button, 
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        
        select { -webkit-appearance: none; appearance: none; }
        
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .pulse-active { animation: pulse-red 2s infinite; }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(245, 158, 11, 0); }
            100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0); }
        }

        .vertical-text {
            writing-mode: vertical-rl;
            text-orientation: mixed;
            transform: rotate(180deg);
        }
    </style>
</head>
<body class="min-h-screen pb-32 selection:bg-amber-500 selection:text-slate-900">

    <nav class="border-b border-slate-800 bg-slate-900/95 backdrop-blur-md sticky top-0 z-50">
        <div class="max-w-3xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <span class="text-3xl">üõ°Ô∏è</span>
                <div>
                    <h1 class="text-2xl font-semibold tracking-wide text-white brand-font uppercase">Safe<span class="text-amber-500">Max</span></h1>
                </div>
            </div>
             <div class="bg-slate-800 p-1 rounded-lg flex text-xs font-bold border border-slate-700">
                <button onclick="setUnit('kg')" id="btn-kg" class="px-3 py-1.5 rounded-md transition-all bg-amber-500 text-slate-900 shadow">KG</button>
                <button onclick="setUnit('lbs')" id="btn-lbs" class="px-3 py-1.5 rounded-md transition-all text-slate-400 hover:text-white">LBS</button>
            </div>
        </div>
    </nav>

    <div class="max-w-3xl mx-auto px-6 mt-6 space-y-6">

        <div class="bg-slate-900 border border-slate-800 rounded-2xl p-6 shadow-lg">
            <h2 class="text-white text-xl uppercase tracking-wide brand-font mb-4 flex items-center gap-2">
                <span class="text-amber-500">1.</span> Calculate Stats
            </h2>
            
            <div class="grid grid-cols-2 gap-4 mb-2">
                <div>
                    <label class="block text-slate-400 text-[10px] font-bold uppercase tracking-widest mb-2">Weight Lifted</label>
                    <div class="relative">
                        <input type="number" id="input-weight" placeholder="100" oninput="calculate()" class="w-full bg-slate-950 text-white p-3 rounded-xl border border-slate-800 focus:border-amber-500 outline-none font-bold text-2xl text-center placeholder-slate-800 transition-all focus:ring-1 focus:ring-amber-500/50">
                        <span id="label-unit" class="absolute right-3 top-5 text-slate-600 text-[10px] font-bold">KG</span>
                    </div>
                </div>

                <div>
                    <label class="block text-slate-400 text-[10px] font-bold uppercase tracking-widest mb-2">Reps Performed</label>
                    <div class="relative">
                        <input type="number" id="input-reps" placeholder="5" oninput="calculate()" class="w-full bg-slate-950 text-white p-3 rounded-xl border border-slate-800 focus:border-amber-500 outline-none font-bold text-2xl text-center placeholder-slate-800 transition-all focus:ring-1 focus:ring-amber-500/50">
                        <span class="absolute right-3 top-5 text-slate-600 text-[10px] font-bold">REPS</span>
                    </div>
                </div>
            </div>
            
             <div id="rep-warning" class="hidden mt-4 text-center">
                <p class="text-[10px] text-orange-400 font-bold bg-orange-500/10 border border-orange-500/20 py-2 rounded-lg inline-block px-4">
                    ‚ö†Ô∏è Accuracy drops above 12 reps.
                </p>
            </div>
        </div>

        <div id="result-panel" class="hidden fade-in space-y-6">
            
            <div class="bg-gradient-to-br from-slate-800 to-slate-900 border border-slate-700 rounded-2xl p-6 text-center relative overflow-hidden shadow-xl">
                <div class="absolute top-0 right-0 w-64 h-64 bg-amber-500/5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"></div>
                <p class="text-slate-400 text-xs font-bold uppercase tracking-widest mb-2">Estimated 1 Rep Max</p>
                <div class="flex justify-center items-baseline gap-2">
                    <span id="val-1rm" class="text-7xl font-black text-white brand-font tracking-tight drop-shadow-lg">--</span>
                    <span id="val-unit" class="text-xl text-slate-500 font-bold">KG</span>
                </div>
            </div>

            <div class="bg-slate-900 border border-slate-800 rounded-2xl overflow-hidden shadow-xl shadow-black/20">
                <div class="p-4 bg-slate-950 border-b border-slate-800">
                    <div class="flex flex-wrap gap-4 justify-between items-center mb-4">
                        <h3 class="text-white font-bold brand-font text-xl flex items-center gap-2">
                            <span class="text-amber-500">2.</span> Ramp-Up Strategy
                        </h3>
                        
                        <div class="relative">
                            <select id="warmup-target" onchange="calculate()" class="bg-slate-800 text-white font-bold text-xs uppercase tracking-wider py-2 pl-3 pr-8 rounded-lg border border-slate-700 focus:border-amber-500 outline-none cursor-pointer appearance-none hover:bg-slate-700 transition">
                                <option value="1">Target: 1 Rep Max</option>
                                <option value="3">Target: 3 Rep Max</option>
                                <option value="5" selected>Target: 5 Rep Max</option>
                                <option value="8">Target: 8 Rep Max</option>
                                <option value="10">Target: 10 Rep Max</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-400">
                                <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-3 pb-2 border-b border-slate-800/50">
                        <div>
                            <label class="block text-slate-500 text-[9px] font-bold uppercase tracking-widest mb-1">Bar Weight</label>
                            <select id="bar-weight" onchange="calculate()" class="w-full bg-slate-900 text-slate-300 text-xs p-2 rounded border border-slate-700 outline-none focus:border-amber-500 transition-colors">
                                <option value="0">Machine (0)</option>
                                <option value="10">10 (EZ/Light)</option>
                                <option value="15">15 (Women's)</option>
                                <option value="20" selected>20 (Standard)</option>
                                <option value="25">25 (Heavy)</option>
                                <option value="45">45 (Lbs Std)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-slate-500 text-[9px] font-bold uppercase tracking-widest mb-1">Smallest Plate/Inc</label>
                            <select id="rounding-factor" onchange="calculate()" class="w-full bg-slate-900 text-slate-300 text-xs p-2 rounded border border-slate-700 outline-none focus:border-amber-500 transition-colors">
                                <option value="0.5">0.5</option>
                                <option value="1">1.0</option>
                                <option value="1.25" selected>1.25</option>
                                <option value="2.5">2.5</option>
                                <option value="5">5.0</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="p-4 space-y-4" id="warmup-container">
                    </div>
            </div>
            
            <div class="bg-slate-900 border border-slate-800 rounded-2xl overflow-hidden shadow-lg">
                <div class="p-3 bg-slate-950 border-b border-slate-800">
                     <h3 class="text-white text-sm font-bold brand-font tracking-wide">Percentage Reference</h3>
                </div>

                <div class="p-0">
                    <table class="w-full text-sm text-left text-slate-400">
                        <thead class="text-xs text-slate-500 uppercase bg-slate-900/50">
                            <tr>
                                <th class="px-2 py-3 w-10 text-center">Zone</th>
                                <th class="px-4 py-3">%</th>
                                <th class="px-4 py-3">Load</th>
                                <th class="px-4 py-3 text-right">Reps</th>
                            </tr>
                        </thead>
                        <tbody id="percentage-table-body" class="divide-y divide-slate-800/50"></tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>

    <div id="timer-bar" class="fixed bottom-0 left-0 w-full bg-slate-900 border-t border-amber-500/30 p-4 transform translate-y-full transition-transform duration-300 z-50 shadow-[0_-10px_40px_rgba(0,0,0,0.5)]">
        <div class="max-w-3xl mx-auto flex items-center justify-between">
            <div class="flex flex-col">
                <span class="text-[10px] text-amber-500 uppercase font-bold tracking-widest">Rest Timer</span>
                <span id="timer-display" class="text-3xl font-black text-white brand-font font-mono">00:00</span>
            </div>
            <div class="flex gap-2">
                <button onclick="addTime(30)" class="bg-slate-800 hover:bg-slate-700 text-white text-xs px-3 py-2 rounded border border-slate-700 font-bold transition-colors">+30s</button>
                <button onclick="stopTimer()" class="bg-slate-800 hover:bg-red-900/30 hover:border-red-500/50 hover:text-red-400 text-slate-400 text-xs px-4 py-2 rounded border border-slate-700 font-bold uppercase transition-all">Stop</button>
            </div>
        </div>
        <div class="absolute top-0 left-0 h-1 bg-amber-500 transition-all duration-1000 ease-linear" id="timer-progress" style="width: 100%"></div>
    </div>

    <script>
        let unit = 'kg';
        let timerInterval;
        let totalTime = 0;
        let remainingTime = 0;
        let audioCtx;

        window.onload = function() {
            loadData();
        };

        function saveData() {
            const data = {
                weight: document.getElementById('input-weight').value,
                reps: document.getElementById('input-reps').value,
                unit: unit,
                barWeight: document.getElementById('bar-weight').value,
                rounding: document.getElementById('rounding-factor').value
            };
            localStorage.setItem('powerCalcData', JSON.stringify(data));
        }

        function loadData() {
            const saved = localStorage.getItem('powerCalcData');
            if (saved) {
                const data = JSON.parse(saved);
                document.getElementById('input-weight').value = data.weight || '';
                document.getElementById('input-reps').value = data.reps || '';
                document.getElementById('bar-weight').value = data.barWeight || '20';
                document.getElementById('rounding-factor').value = data.rounding || '1.25';
                if(data.unit) setUnit(data.unit);
            }
            if (document.getElementById('input-weight').value) calculate();
        }

        function setUnit(u) {
            unit = u;
            document.getElementById('label-unit').innerText = u.toUpperCase();
            document.getElementById('val-unit').innerText = u.toUpperCase();
            
            if (u === 'kg') {
                document.getElementById('btn-kg').className = "px-3 py-1.5 rounded-md transition-all bg-amber-500 text-slate-900 shadow font-bold";
                document.getElementById('btn-lbs').className = "px-3 py-1.5 rounded-md transition-all text-slate-400 hover:text-white font-medium";
            } else {
                document.getElementById('btn-lbs').className = "px-3 py-1.5 rounded-md transition-all bg-amber-500 text-slate-900 shadow font-bold";
                document.getElementById('btn-kg').className = "px-3 py-1.5 rounded-md transition-all text-slate-400 hover:text-white font-medium";
            }
            calculate();
        }

        function calculate() {
            const weight = parseFloat(document.getElementById('input-weight').value);
            const reps = parseFloat(document.getElementById('input-reps').value);
            const targetReps = parseInt(document.getElementById('warmup-target').value);
            const rounding = parseFloat(document.getElementById('rounding-factor').value);
            const resultPanel = document.getElementById('result-panel');
            const warningPanel = document.getElementById('rep-warning');

            saveData();

            if (!weight || !reps) {
                resultPanel.classList.add('hidden');
                return;
            }

            if (reps > 12) warningPanel.classList.remove('hidden');
            else warningPanel.classList.add('hidden');

            let oneRM = weight * (1 + reps / 30);
            oneRM = Math.round(oneRM * 2) / 2;

            resultPanel.classList.remove('hidden');
            document.getElementById('val-1rm').innerText = oneRM;

            const standardRounding = unit === 'kg' ? 0.5 : 1.0;
            renderTable(oneRM, standardRounding);
            renderWarmup(oneRM, targetReps, rounding);
        }

        function roundTo(val, step) {
            return Math.round(val / step) * step;
        }

        function renderWarmup(oneRM, targetReps, rounding) {
            const container = document.getElementById('warmup-container');
            const barWeight = parseFloat(document.getElementById('bar-weight').value);
            container.innerHTML = '';

            let targetLoad = oneRM / (1 + targetReps / 30);
            
            const steps = [
                { title: "Activation", pct: 0.20, reps: "15", restSec: 0, notes: "Light Flow" },
                { title: "Patterning", pct: 0.50, reps: "5", restSec: 60, notes: "Fast Speed" },
                { title: "Acclimation", pct: 0.70, reps: "3", restSec: 120, notes: "Build Up" },
                { title: "Primer", pct: 0.90, reps: targetReps > 5 ? "2" : "1", restSec: 180, notes: "Heavy Feel" },
                { title: `TEST ${targetReps}RM`, pct: 1.00, reps: targetReps, restSec: 240, notes: "TARGET SET" }
            ];

            steps.forEach((step, index) => {
                let rawLoad = targetLoad * step.pct;
                let finalLoad = 0;
                let plateText = "";

                if (barWeight === 0) {
                    finalLoad = roundTo(rawLoad, rounding);
                    plateText = "Set Pin / Load";
                } else {
                    if (rawLoad <= barWeight) {
                        finalLoad = barWeight;
                        plateText = "Empty Bar";
                    } else {
                        let idealSide = (rawLoad - barWeight) / 2;
                        let roundedSide = roundTo(idealSide, rounding);
                        
                        finalLoad = barWeight + (roundedSide * 2);
                        
                        if (roundedSide > 0) {
                            plateText = `+${roundedSide}${unit} / side`;
                        } else {
                             plateText = "Empty Bar";
                        }
                    }
                }
                
                let borderClass = "border-slate-800";
                let bgClass = "bg-slate-900";
                let textClass = "text-white";
                let btnColor = "text-slate-400 bg-slate-950/50 border-slate-700 hover:text-white hover:border-slate-500";
                let numColor = "text-white";
                let badgeColor = "text-slate-400 border-slate-700 bg-slate-950";
                
                if (step.pct === 1.0) {
                    borderClass = "border-amber-500/50";
                    bgClass = "bg-amber-500/5";
                    textClass = "text-amber-500 font-bold";
                    numColor = "text-amber-500";
                    btnColor = "text-amber-400 bg-amber-900/20 border-amber-500/30 hover:bg-amber-900/40";
                    badgeColor = "text-amber-400 border-amber-500/30 bg-amber-900/20";
                } else if (step.pct === 0.90) {
                     textClass = "text-amber-200";
                     borderClass = "border-slate-700";
                }

                let restLabel = step.restSec === 0 ? "None" : (step.restSec >= 60 ? `${step.restSec/60}m` : `${step.restSec}s`);
                
                let timerBtn = step.restSec > 0 ? 
                    `<button onclick="startTimer(${step.restSec})" class="w-full text-[10px] uppercase font-bold py-2.5 px-4 rounded-lg border flex items-center justify-center gap-2 transition-all ${btnColor}">
                        <span>‚è±Ô∏è</span> ${restLabel}
                    </button>` : 
                    `<div class="w-full text-[10px] uppercase font-bold text-slate-600 py-2.5 px-4 text-center border border-transparent">No Rest</div>`;

                const div = document.createElement('div');
                div.className = `group relative overflow-hidden rounded-xl border ${borderClass} ${bgClass} p-4 transition-all hover:border-slate-600 hover:shadow-lg`;
                
                // Responsive Grid Layout
                div.innerHTML = `
                    <div class="flex flex-col gap-4">
                        
                        <div class="flex items-center gap-3 border-b border-white/5 pb-2">
                             <div class="bg-slate-800 text-slate-500 w-6 h-6 flex items-center justify-center rounded-full text-[10px] font-bold border border-slate-700">${index + 1}</div>
                             <div>
                                <span class="font-bold ${textClass} text-lg uppercase tracking-wide leading-none">${step.title}</span>
                                <span class="ml-2 text-[10px] uppercase tracking-wider font-bold text-slate-500">${step.notes}</span>
                             </div>
                        </div>

                        <div class="grid grid-cols-3 md:grid-cols-4 items-baseline gap-y-4 gap-x-2">
                            
                            <div class="flex flex-col">
                                <span class="text-[9px] font-bold text-slate-500 uppercase tracking-widest">Load</span>
                                <div class="flex items-baseline gap-0.5">
                                    <span class="text-3xl font-black ${numColor} brand-font tracking-tight">${finalLoad}</span>
                                    <span class="text-[10px] font-bold text-slate-600">${unit}</span>
                                </div>
                            </div>

                            <div class="flex flex-col pl-2 border-l border-white/5">
                                <span class="text-[9px] font-bold text-slate-500 uppercase tracking-widest">Reps</span>
                                <div class="flex items-baseline gap-0.5">
                                     <span class="text-3xl font-black text-white brand-font tracking-tight">${step.reps}</span>
                                     <span class="text-[10px] font-bold text-slate-600">REPS</span>
                                </div>
                            </div>

                            <div class="flex flex-col pl-2 border-l border-white/5">
                                <span class="text-[9px] font-bold text-slate-500 uppercase tracking-widest">Plate</span>
                                <div class="text-xl font-bold text-slate-400 brand-font whitespace-nowrap overflow-hidden text-ellipsis leading-none py-1">
                                    ${plateText}
                                </div>
                            </div>

                            <div class="col-span-3 md:col-span-1 md:justify-self-end mt-1 md:mt-0 flex items-center h-full">
                                ${timerBtn}
                            </div>

                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function renderTable(oneRM, rounding) {
            const tbody = document.getElementById('percentage-table-body');
            tbody.innerHTML = '';
            
            const data = [
                { pct: 100, reps: '1', zone: 'POWER', span: 4, color: 'text-amber-500', border: 'border-l-2 border-amber-500' }, 
                { pct: 95, reps: '2' }, 
                { pct: 90, reps: '3-4' },
                { pct: 85, reps: '5-6' }, 
                { pct: 80, reps: '7-8', zone: 'HYPERTROPHY', span: 3, color: 'text-blue-400', border: 'border-l-2 border-blue-500' }, 
                { pct: 75, reps: '9-10' },
                { pct: 70, reps: '11-12' }, 
                { pct: 65, reps: '13-15', zone: 'ENDURANCE', span: 2, color: 'text-emerald-400', border: 'border-l-2 border-emerald-500' }, 
                { pct: 60, reps: '16-20' }
            ];

            data.forEach((row) => {
                let load = roundTo(oneRM * (row.pct / 100), rounding);

                let colorClass = "text-slate-400";
                if(row.pct === 100) colorClass = "text-amber-500 font-bold";
                
                const tr = document.createElement('tr');
                
                let zoneHtml = '';
                if (row.zone) {
                    zoneHtml = `<td rowspan="${row.span}" class="p-0 text-center align-middle bg-slate-900/30 ${row.border}">
                        <div class="vertical-text text-[9px] font-bold tracking-widest uppercase ${row.color} opacity-80">${row.zone}</div>
                    </td>`;
                }

                tr.innerHTML = `
                    ${zoneHtml}
                    <td class="px-4 py-2 font-bold ${colorClass} text-xs">${row.pct}%</td>
                    <td class="px-4 py-2 font-mono text-white text-sm">${load}</td>
                    <td class="px-4 py-2 text-right text-[10px] uppercase tracking-wide text-slate-500 font-bold">${row.reps}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        /* --- Audio & Timer Logic --- */
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        function beep(duration, frequency, volume, type) {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            gainNode.gain.value = volume;
            osc.frequency.value = frequency;
            osc.type = type;
            
            osc.start(audioCtx.currentTime);
            osc.stop(audioCtx.currentTime + (duration / 1000));
        }

        function playAlarm() {
            initAudio(); 
            // 3 Beeps
            beep(200, 800, 0.5, 'square');
            setTimeout(() => beep(200, 800, 0.5, 'square'), 400);
            setTimeout(() => beep(600, 600, 0.5, 'square'), 800);

            document.getElementById('timer-display').classList.add('text-red-500', 'pulse-active');
            setTimeout(() => {
                 document.getElementById('timer-display').classList.remove('text-red-500', 'pulse-active');
                 stopTimer();
            }, 3000);
        }

        function startTimer(seconds) {
            initAudio();
            clearInterval(timerInterval);
            totalTime = seconds;
            remainingTime = seconds;
            
            const timerBar = document.getElementById('timer-bar');
            timerBar.classList.remove('translate-y-full'); 
            
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                remainingTime--;
                updateTimerDisplay();
                if (remainingTime <= 0) {
                    clearInterval(timerInterval);
                    playAlarm();
                }
            }, 1000);
        }

        function addTime(sec) {
            remainingTime += sec;
            totalTime += sec; 
            updateTimerDisplay();
        }

        function stopTimer() {
            clearInterval(timerInterval);
            document.getElementById('timer-bar').classList.add('translate-y-full');
        }

        function updateTimerDisplay() {
            const mins = Math.floor(remainingTime / 60);
            const secs = remainingTime % 60;
            document.getElementById('timer-display').innerText = 
                `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            
            const pct = (remainingTime / totalTime) * 100;
            document.getElementById('timer-progress').style.width = `${pct}%`;
        }
    </script>
</body>
</html>